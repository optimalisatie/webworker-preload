
/*!
 * Web Worker Preloader v0.0.1
 * By https://pagespeed.pro/
 * https://github.com/optimalisatie/webworker-preload
 */
!function(a){if("undefined"!=typeof Worker)var b=!0;else var b=!1;if("undefined"==typeof console||"undefined"==typeof console.error)var c=function(a){};else var c=function(){console.error.apply(console,arguments)};var d=function(){var a=function(a){var d=[];if(a instanceof Array)for(var e=a.length,f=0;f<e;f++)if(a[f]instanceof Array){if(a[f].length<1||a[f].length>3)throw new Error("wwpreload: array config (index "+f+") not valid");if("undefined"!=typeof a[f][1]&&isNaN(a[f][1]))throw new Error("wwpreload: array config (index "+f+") not valid (callback id)");d.push(a[f])}else"string"==typeof a[f]&&d.push([a[f]]);var g=[];if(d.length>0)for(var h=d.length,e=d.length,f=0;f<e;f++)!function(a,d){var e=!1,f=function(a){e=!0,d&&c(d,a?"error":"ok"),0===--h&&b(g)},i=new XMLHttpRequest;i.responseType="blob",i.onreadystatechange=function(){e||4===i.readyState&&(200!==i.status?f(!0):f())},i.onload=function a(){a||f()},i.onerror=function(){e||(g.push(a),f(!0))},i.open("GET",a,!0),i.send()}(d[f][0],d[f][1])},b=function(a){var b=[1];a.length>0&&b.push(a),self.postMessage(b),self.close()},c=function(a,b){self.postMessage([2,a,b])};self.onmessage=function(b){a(b.data,postMessage)}}.toString().replace(/^function\s*\(\s*\)\s*\{/,"").replace(/\}$/,""),e=function(a){var b;try{b=new Blob([a],{type:"application/javascript"})}catch(c){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,b=new BlobBuilder,b.append(a),b=b.getBlob()}return URL.createObjectURL(b)},f=e(d),g={},h=0,i=function(a){var b=document.createElement("a");return b.href=a,b.protocol+"//"+b.host+b.pathname+b.search},j=function(a,b,d){for(var e=[],j=[],k=function(a){"object"==typeof a&&a.preventDefault&&a.preventDefault(),c("preloadww:",a),d&&d(a)},l=a.length,m=0;m<l;m++)if(a[m]instanceof Array){if(a[m].length<1||a[m].length>3)return void k("invalid resource config at index",m,a[m]);if(a[m][1]){if("function"!=typeof a[m][1])return void k("resource onload callback is not a function",m,a[m]);var n=++h;g["cb"+n]=a[m][1],a[m][1]=n}j.push(a[m][0]),a[m][0]=i(a[m][0]),e.push(a[m])}else if("object"==typeof a[m]){if(!a[m].uri)return void k("invalid resource config at index",m,a[m]);j.push(a[m].uri);var o=[i(a[m].uri)];if(a[m].callback){if("function"!=typeof a[m].callback)return void k("resource onload callback is not a function",m,a[m]);var n=++h;g["cb"+n]=a[m].callback,a[m].callback=n,o.push(n),a[m].type&&o.push(a[m].type)}else a[m].type&&o.push(null,a[m].type);e.push(o)}else"string"==typeof a[m]&&(j.push(a[m]),e.push(i(a[m])));if(0===e.length)return void k("no resources to preload");var p=new Worker(f);p.addEventListener("message",function(a){var d=a.data;if(d instanceof Array){if(1===parseInt(d[0]))d[1]&&c("preloadww:","failed to load",d[1]),b(j),p&&(p.terminate(),p=void 0);else if(2===parseInt(d[0])){var e=d[1],f=1===parseInt(d[2])?"ok":"error";"undefined"!=typeof g["cb"+e]&&(g["cb"+e](f),delete g["cb"+e])}}else k("invalid response from worker")}),p.addEventListener("error",k),p.postMessage(e)},k=function(a,d,e){if(!b)return void c("preloadww: web workers not supported");if(a instanceof Array);else if("object"==typeof a&&a.uri)a=[a];else{if("string"!=typeof a)return void c("preloadww: invalid resource config",a);a=[a]}j(a,d,e)};"object"==typeof module&&module.exports?module.exports=k:"function"==typeof define&&define.amd?define([],function(){return k}):a.preloadww=k}("object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||this);
